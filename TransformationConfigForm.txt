Private Sub UserForm_Initialize()    
End Sub


Function handleErr(err As ErrObject)
    If StrComp(Err.Description, "User input is a keyword", 1) = 0 Then
        ' One of the keywords was entered
        Dim inputString As String
        Err.Clear
        inputString = ThisDrawing.Utility.GetInput
        MsgBox "You entered the keyword: " & inputString
    Else
        MsgBox "Error selecting the point: " & Err.Description
        Err.Clear
    End If
End Function

' Add point command button
Private Sub addPointButton_Click()
    On Error Resume Next
    pointsFrame.Enabled = True
    basePointsFrame.Enabled = True
    referencePointsFrame.Enabled = True
    basePointsListBox.Enabled = True
    referencePointsListBox.Enabled = True
    hide

    Dim returnPnt As Variant

    Dim Msg, Style, Title, Help, Ctxt, Response, MyString
    Msg = "Choose couple of points."
    Style = vbYesNo
    Title = "MsgBox Demonstration"
    Help = "DEMO.HLP"
    Ctxt = 1000
    Response = MsgBox(Msg, Style, Title, Help, Ctxt)

    Dim pointIndex As Integer : pointIndex = 0
    Do While Response = vbYes
        MyString = "Yes"    ' Perform some action.
        pointIndex = pointIndex + 1
       
        returnPnt = ThisDrawing.Utility.GetPoint(, "Input point")
        If Err Then
            handleErr(Err)            
        End If

        ThisDrawing.ModelSpace.AddPoint returnPnt
        ThisDrawing.ModelSpace.AddText VBA.Str(pointIndex), returnPnt, 1
        basePointsListBox.AddItem (pointIndex & ")" & VBA.Str(returnPnt(0)) & "," & VBA.Str(returnPnt(1)))

        returnPnt = ThisDrawing.Utility.GetPoint(, "Input corresponding point")
        ThisDrawing.ModelSpace.AddPoint returnPnt
        ThisDrawing.ModelSpace.AddText VBA.Str(pointIndex), returnPnt, 1

        If Err Then
            handleErr(Err)            
        End If

        referencePointsListBox.AddItem (pointIndex & ")" & VBA.Str(returnPnt(0)) & "," & VBA.Str(returnPnt(1)))
        Response = MsgBox(Msg, Style, Title, Help, Ctxt)
        If Response = vbNo Then
            Show
            Exit Do
        End If

    Loop ' User chose No.

End Sub

Function removePointFromListBox(listBox As ListBox)
    Dim numberOfPoints As Integer
    numberOfPoints = listBox.ListCount

    'Ensure ListBox contains list items
    Dim selectedIndex As Integer
    selectedIndex = listBox.ListIndex
    If (numberOfPoints >= 1) Then
        'If no selection, choose the last list item.
        If (selectedIndex = -1) Then
            selectedIndex = numberOfPoints - 1
        End If
        basePointsListBox.RemoveItem (selectedIndex)
    End If
End Function


' Remove point command button
Private Sub removePointButton_Click()
    removePointFromListBox(basePointsListBox)
    removePointFromListBox(referencePointsListBox)
End Sub

' OK commandButton
Private Sub okButton_Click()
    Dim numberOfPoints As Integer
    numberOfPoints = basePointsListBox.ListCount

    apriori_s = sAprioriTextBox.Text

    Call transformation(vathmos, numberOfPoints, basePointsListBox, referencePointsListBox)

    UserForm4_Report.Show
End Sub

' Cancel commandButton
Private Sub cancelButton_Click()
    Unload Me
End Sub

' Apply commandButton
Private Sub applyButton_Click()
    Call applyTransformation(met, kr, lr, xekt)
End Sub
