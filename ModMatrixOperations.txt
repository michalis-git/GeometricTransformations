Attribute VB_Name = "ModMatrixOperations"

Public Function transposeMatrix(A As Variant) As Variant
    Dim i, j As Integer
    Dim xUpper As Long 
    Dim yUpper As Long 
    Dim tempArray As Variant 
    

    xUpper = UBound(myarray, 2) 
    yUpper = UBound(myarray, 1)
    ReDim tempArray(xUpper, yUpper)  
    For i = 0 To xUpper
        For j = 0 To yUpper
             tempArray(i, j) = A(j, i)
        Next j
    Next i

    transposeMatrix = tempArray

End Function


Public Function multiplyMatrices(a As Variant, b As Variant) As Variant
    Dim aXupper, aYupper As Long 
    Dim bXupper, bYupper As Long
    Dim c As Variant

    aXUpper = UBound(a, 1) 
    aYupper = UBound(a, 2)
    bXUpper = UBound(b, 1) 
    bYupper = UBound(b, 2)

    If bXUpper <> aYupper Then
        productMatrix = "Not Defined!"
        Exit Function
    End If
    n = UBound(B, 2)

    ReDim c(1 To aXupper, 1 To bYupper)
    For i = 1 To aXupper
        For j = 1 To bYupper
            For k = 1 To aYupper
                c(i, j) = c(i, j) + a(i, k) * b(k, j)
            Next k
        Next j
    Next i

    multiplyMatrices = c

End Function

Public Function identityMatrix(dimension As Integer) As Variant
    ReDim I(0 To dimension-1, 0 To dimension-1) As Variant
    For i = 0 To dimension-1
        For j = 0 To dimension-1
            If i = j Then
                P(i, j) = 1
            Else
                P(i, j) = 0
            End If
        Next j
    Next i
    identityMatrix = I
End Function

Public Function inverseMatrix(parameters1 As Single, Nmat1 As Variant)
    Solution_Problem = False
    ReDim Operations_Matrix(1 To 2 * parameters1, 1 To 2 * 2 * parameters1)
    'Assign values from matrix [A] at the left
    For n = 1 To 2 * parameters1
        For m = 1 To 2 * parameters1
            Operations_Matrix(m, n) = Nmat1(m, n)
        Next
    Next

    'Assign values from singular matrix [I] at the right
    For n = 1 To 2 * parameters1
        For m = 1 To 2 * parameters1
            If n = m Then
                Operations_Matrix(m, n + 2 * parameters1) = 1
            Else
                Operations_Matrix(m, n + 2 * parameters1) = 0
            End If
        Next
    Next

    'Build the Singular matrix [I] at the left
    For k = 1 To 2 * parameters1
        'Bring a non-zero element first by changes lines if necessary
        If Operations_Matrix(k, k) = 0 Then
            For n = k To 2 * parameters1
                If Operations_Matrix(n, k) <> 0 Then
                    line_1 = n: Exit For 'Finds line_1 with non-zero element
            Next n
            'Change line k with line_1
            For m = k To 2 * parameters1 * 2
                temporary_1 = Operations_Matrix(k, m)
                Operations_Matrix(k, m) = Operations_Matrix(line_1, m)
                Operations_Matrix(line_1, m) = temporary_1
            Next m
        End If
   
        elem1 = Operations_Matrix(k, k)
        For n = k To 2 * 2 * parameters1
            Operations_Matrix(k, n) = Operations_Matrix(k, n) / elem1
        Next n
   
        'For other lines, make a zero element by using:
        'Ai1=Aij-A11*(Aij/A11)
        'and change all the line using the same formula for other elements
        For n = 1 To 2 * parameters1
            If n = k And n = 2 * parameters1 Then Exit For 'Finished
            If n = k And n < 2 * parameters1 Then n = n + 1 'Do not change that element (already equals to 1), go for next one
            If Operations_Matrix(n, k) <> 0 Then 'if it is zero, stays as it is
                multiplier_1 = Operations_Matrix(n, k) / Operations_Matrix(k, k)
                For m = k To 2 * 2 * parameters1
                    Operations_Matrix(n, m) = Operations_Matrix(n, m) - Operations_Matrix(k, m) * multiplier_1
                Next m
            End If
        Next n
    Next k

    ReDim inverse_N(1 To 2 * parameters1, 1 To 2 * parameters1)
    'Assign the right part to the inverse_N
    For n = 1 To 2 * parameters1
        For k = 1 To 2 * parameters1
            inverse_N(n, k) = Operations_Matrix(n, 2 * parameters1 + k)
        Next k
    Next n

    inverseMatrix = inverse_N

End Sub



