Attribute VB_Name = "ModResiduals"

Public Dx, Dy, sse, xvect, yvect As Variant
Public nn As Integer
Sub residual(xvect As Variant, yvect As Variant, xEstimation As Variant, n As Integer)
    nn = n
    Dim AxFinal, AyFinal, Ax, Ay As Variant

    ReDim Dx(1 To n)
    ReDim Dy(1 To n)
    ReDim sse(1 To n)
    AxFinal = 0
    AyFinal = 0
    
    For i = 1 To n
        Ax = 0: Ay = 0
    
        If index = "Similarity" Then
            AxFinal = xEstimation(1) + xEstimation(2) * xvect(i) + xEstimation(3) * yvect(i)
            AyFinal = xEstimation(4) + xEstimation(2) * yvect(i) - xEstimation(3) * xvect(i)
        Else
            For j = 1 To met
                Ax = xEstimation(j) * xvect(i) ^ kr(j) * yvect(i) ^ lr(j)
                Ay = xEstimation(j + met) * xvect(i) ^ kr(j) * yvect(i) ^ lr(j)
                AxFinal = AxFinal + Ax
                AyFinal = AyFinal + Ay
            Next j
        End If

        Dx(i) = AxFinal - b(i)
        Dy(i) = AyFinal - b(n + i)
        sse(i) = Sqr(Dx(i) ^ 2 + Dy(i) ^ 2)
        AxFinal = 0
        AyFinal = 0
    Next i


    AxFinal = 0: AyFinal = 0: Ax = 0: Ay = 0: gr = 0

End Sub
